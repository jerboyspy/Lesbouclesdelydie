        // Remplacez tout votre bloc <script> actuel par celui-ci :
        const _supabase = supabase.createClient("https://rsebvgdneetbbmdchwil.supabase.co", "sb_publishable_c_U9tbQzawyqAVuLTEYWWA_XBW6Fbs6");

        netlifyIdentity.on('init', user => { 
            if (!user) window.location.href = "/"; 
            chargerListe(); 
        });

        document.getElementById('produit-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const btn = document.getElementById('btn-submit');
            const fileInput = document.getElementById('fileInput');
            const file = fileInput.files[0];
            
            if(!file) return alert("Veuillez choisir une photo");

            btn.disabled = true;
            btn.innerText = "â³ ENVOI EN COURS...";

            try {
                // 1. On prÃ©pare l'image
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = async () => {
                    const base64Content = reader.result.split(',')[1];
                    const fileName = `img_${Date.now()}.${file.name.split('.').pop()}`;

                    // 2. On appelle notre fonction Netlify (C'est elle qui a le Token !)
                    const res = await fetch('/.netlify/functions/upload', {
                        method: 'POST',
                        body: JSON.stringify({ fileName, content: base64Content })
                    });

                    if(!res.ok) throw new Error("Erreur lors de l'envoi de l'image");

                    // 3. On enregistre dans Supabase
                    const { error } = await _supabase.from('produits').insert([{
                        titre: document.getElementById('titre').value,
                        prix: parseFloat(document.getElementById('prix').value),
                        stock: parseInt(document.getElementById('stock').value),
                        image: `/images/${fileName}`
                    }]);

                    if (error) throw error;
                    
                    alert("Bijou ajoutÃ© avec succÃ¨s !");
                    location.reload();
                };
            } catch (err) {
                alert("Erreur : " + err.message);
                btn.disabled = false;
                btn.innerText = "ğŸš€ Mettre en ligne";
            }
        });

        async function chargerListe() {
            const { data } = await _supabase.from('produits').select('*').order('id', { ascending: false });
            document.getElementById('produits-list').innerHTML = data ? data.map(p => `
                <div class="flex items-center justify-between p-3 bg-white rounded-2xl shadow-sm border">
                    <img src="${p.image}" class="w-12 h-12 rounded-xl object-cover">
                    <span class="text-xs font-bold">${p.titre}</span>
                    <button onclick="supprimer(${p.id})" class="text-red-400">ğŸ—‘ï¸</button>
                </div>
            `).join('') : '';
        }

        async function supprimer(id) {
            if(confirm("Supprimer ?")) { await _supabase.from('produits').delete().eq('id', id); chargerListe(); }
        }
