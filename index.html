<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Les Boucles de Lydie</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
</head>
<body class="bg-gray-50 text-gray-800">

    <div id="admin-bar" class="hidden bg-black text-white p-2 text-center text-[10px] gap-4 sticky top-0 z-[60]">
        <a href="/admin/index.html" class="font-bold underline">ðŸ“¦ GÃ‰RER STOCK</a> | 
        <a href="/admin/admin-commandes.html" class="font-bold underline">ðŸ“‹ COMMANDES</a>
    </div>

    <nav class="bg-white shadow-sm p-4 sticky top-0 z-50 flex justify-between items-center">
        <h1 class="text-xl font-bold text-pink-600">Les Boucles de Lydie</h1>
        <div class="flex gap-3">
            <button onclick="netlifyIdentity.open()" id="auth-btn" class="text-[10px] bg-gray-100 px-3 py-2 rounded font-bold uppercase">ðŸ‘¤ Connexion</button>
            <button onclick="toggleModal('cart-modal')" class="relative p-2 bg-pink-100 rounded-full">
                ðŸ›’ <span id="cart-count" class="absolute -top-1 -right-1 bg-red-500 text-white text-[10px] px-1 rounded-full font-bold">0</span>
            </button>
        </div>
    </nav>

    <main class="max-w-6xl mx-auto p-4 mb-20">
        <div id="produits-container" class="grid grid-cols-2 md:grid-cols-4 gap-4">
            <p class="col-span-full text-center py-20 italic text-gray-400">Chargement de la collection...</p>
        </div>
    </main>

    <a href="https://wa.me/33673460409" target="_blank" style="position:fixed;bottom:20px;right:20px;background:#25d366;color:white;padding:12px 20px;border-radius:50px;z-index:100;text-decoration:none;font-weight:bold;box-shadow:0 4px 10px rgba(0,0,0,0.2);">ðŸ’¬ WhatsApp</a>

    <script>
        const _supabase = supabase.createClient("https://rsebvgdneetbbmdchwil.supabase.co", "sb_publishable_c_U9tbQzawyqAVuLTEYWWA_XBW6Fbs6");
        let panier = [];

        netlifyIdentity.on('init', user => {
            if (user && user.email === "lydie90@wanadoo.fr") document.getElementById('admin-bar').classList.remove('hidden');
            chargerBoutique();
        });

        async function chargerBoutique() {
            const container = document.getElementById('produits-container');
            const { data, error } = await _supabase.from('produits').select('*').eq('disponible', true);
            
            if (error) {
                container.innerHTML = "<p class='col-span-full text-center py-10'>Erreur de chargement. VÃ©rifiez la table 'produits' dans Supabase.</p>";
                return;
            }

            container.innerHTML = data.map(p => `
                <div class="bg-white p-3 rounded-2xl shadow-sm border border-gray-100 flex flex-col h-full">
                    <img src="${p.image}" class="w-full h-44 object-cover rounded-xl mb-2">
                    <h4 class="font-bold text-[12px] mb-1">${p.titre}</h4>
                    <p class="text-pink-600 font-black text-lg mb-3">${parseFloat(p.prix).toFixed(2)} â‚¬</p>
                    <button onclick="ajouterAuPanier('${p.titre.replace(/'/g, "\\'")}', ${p.prix})" class="bg-pink-500 text-white py-2 rounded-xl text-[11px] font-bold uppercase">Ajouter</button>
                </div>
            `).join('');
        }

        function ajouterAuPanier(n, p) { 
            panier.push({nom:n, prix:p}); 
            document.getElementById('cart-count').innerText = panier.length;
            alert(n + " ajoutÃ© au panier !");
        }
    </script>
</body>
</html>
